{% extends "repairs/base.html" %}
{% load static %}
{% load repairs_extras %}

{% block title %}Модели — {{ brand.name }}{% endblock %}

{% block content %}
<style>
  *{box-sizing:border-box}
  .muted{color:#64748b}

  :root{ --accent:#972B34; }

  /* ——— КНОПКА НАЗАД ——— */
  .back-wrap{margin:2px 0 12px}
  .btn-back{
    --bg:#fff; --ink:#111; --brd:#000;
    display:inline-flex; align-items:center; gap:10px;
    padding:12px 16px; border-radius:12px;
    border:1px solid var(--brd); background:var(--bg); color:var(--ink);
    text-decoration:none; line-height:1; font-weight:600;
    transition:background .2s,color .2s,box-shadow .2s,transform .15s,border-color .2s;
    will-change: transform;
  }
  .btn-back svg{width:18px;height:18px;stroke:currentColor;transition:transform .2s}
  .btn-back:hover{ background:#111; color:#fff; border-color:#111; box-shadow:0 6px 14px rgba(0,0,0,.08) }
  .btn-back:hover svg{transform:translateX(-2px)}
  .btn-back:active{transform:translateY(1px)}
  .btn-back:focus-visible{outline:3px solid #111; outline-offset:2px}

  /* ——— ХЛЕБНЫЕ КРОШКИ ——— */
  .breadcrumbs{
    display:flex; flex-wrap:wrap; align-items:center; gap:8px;
    font-size:13px; color:#64748b; margin:6px 0 6px;
  }
  .breadcrumbs a{ color:inherit; text-decoration:none; font-weight:600 }
  .breadcrumbs a:hover{ text-decoration:underline }
  .breadcrumbs .sep{ opacity:.5 }
  .breadcrumbs .current{ color:#111; font-weight:700 }
  .breadcrumbs .brand{ color:var(--accent); font-weight:800 }

  /* ——— ВЫДЕЛЕННЫЙ БРЕНД-ЗАГОЛОВОК ——— */
  .brand-head{ margin:0 0 8px }
  .brand-title{ font-size:26px; line-height:1.2; margin:0; letter-spacing:.2px; }
  .brand-pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:6px 12px; border-radius:999px;
    border:2px solid var(--accent); color:var(--accent); background:#fff;
    font-weight:800;
  }
  .brand-path{ margin-left:10px; color:#64748b; font-weight:600 }

  /* ——— ЧИПЫ (категории) ——— */
  .chips{display:flex;flex-wrap:wrap;gap:12px;margin:8px 0 16px}
  .chip{
    --g1:#60a5fa; --g2:#a78bfa; --g3:#0ea5e9;
    position:relative;
    display:inline-flex; align-items:center; gap:10px;
    padding:10px 18px;
    border:0; border-radius:16px;
    color:#111;
    background:
      linear-gradient(#fff,#fff) padding-box,
      linear-gradient(135deg,var(--g1),var(--g2),var(--g3)) border-box;
    border:2px solid transparent;
    font-weight:600; font-size:15px; line-height:1;
    text-decoration:none;
    transition:transform .18s, box-shadow .18s, color .18s, background .18s, opacity .18s;
    box-shadow:0 6px 14px rgba(2,8,23,.06);
    -webkit-tap-highlight-color: transparent;
  }
  .chip *{-webkit-tap-highlight-color: transparent}
  .chip:hover{transform:translateY(-1px); box-shadow:0 10px 22px rgba(2,8,23,.09)}
  .chip:active{opacity:.96; transform:translateY(0)}
  .chip:focus-visible{outline:3px solid #111; outline-offset:2px}
  .chip.active{
    color:#fff;
    background: linear-gradient(135deg,var(--g1),var(--g2),var(--g3));
    box-shadow:0 10px 24px rgba(2,8,23,.16);
  }
  .chip .icon{
    width:28px;height:28px;display:inline-grid;place-items:center;
    background:#fff;border-radius:7px;padding:0px;
    box-shadow:0 0 0 1px rgba(0,0,0,.12) inset;
  }
  .chip .img-icon{width:100%;height:100%;object-fit:contain;border-radius:5px;display:block}
  .chip.active .icon{ box-shadow:0 0 0 1px rgba(255,255,255,.78) inset; background:rgba(255,255,255,.98) }

  /* ——— СЕТКА КАРТОЧЕК ——— */
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
  .card{
    border:1px solid #000; border-radius:12px;
    padding:12px;background:#fff;
    display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;
    transition:border-color .15s, box-shadow .15s, background-color .15s;
  }
  .card:hover{background:#fafafa;box-shadow:0 1px 0 rgba(0,0,0,.04)}

  .info .name{font-weight:700;margin-bottom:4px;line-height:1.25; color:var(--accent)}
  .info .name .paren{font-size:.85em;color:#64748b;font-weight:500;margin-left:4px}

  .meta{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .badge{font-size:12px;color:#111;background:#f3f4f6;border-radius:999px;padding:4px 8px}

  .btn{
    display:inline-flex;justify-content:center;align-items:center;padding:10px 14px;
    border-radius:10px;background:#111;color:#fff;text-decoration:none;white-space:nowrap;border:1px solid #111;
    transition:opacity .15s, transform .1s;
  }
  .btn:hover{opacity:.95}
  .btn:active{transform:translateY(1px)}

  /* ——— ПАНЕЛЬ ИНСТРУМЕНТОВ (поиск + переключатель) ——— */
  .tools-bar{
    display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin:8px 0 12px
  }
  /* объединённое поле поиска с кнопкой той же высоты */
  .search{
    display:flex;align-items:center;gap:8px;
    border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;background:#fff;
    flex:1 1 380px; /* растягивается по ширине */
  }
  .search .lead{padding-left:10px;color:#94a3b8;display:inline-flex}
  .search input{
    border:0; outline:0; padding:10px 12px; min-width:140px; flex:1;
    font:inherit;
  }
  .search button{
    border:0; background:#111; color:#fff; padding:10px 14px; cursor:pointer;
    display:inline-flex; align-items:center; gap:8px; height:100%;
  }
  .search button svg{width:18px;height:18px;stroke:currentColor}
  .search button:hover{opacity:.95}

  /* переключатель вида — иконки */
  .view{
    display:inline-flex; border:1px solid #e5e7eb; border-radius:12px; overflow:hidden; background:#fff
  }
  .view a{
    display:inline-flex; align-items:center; justify-content:center;
    width:44px; height:40px; color:#111; text-decoration:none;
  }
  .view a svg{width:18px;height:18px;stroke:currentColor}
  .view a.active{ background:#111; color:#fff }

  /* ——— РЕЖИМ СПИСКОМ ——— */
  .as-list .grid{
    display:block;
    border:1px solid #e5e7eb; border-radius:14px; background:#fff; overflow:hidden;
  }
  .as-list .card{
    grid-template-columns: 1fr auto;
    border:0; border-bottom:1px solid #f2f4f7; border-radius:0;
    padding:14px 18px; background:#fff;
  }
  .as-list .card:last-child{ border-bottom:0 }
  .as-list .card:hover{ background:#fafafa }
  .as-list .info .name{ color: var(--accent); }
  .as-list .btn{ padding:8px 12px; border-radius:8px }

  /* ——— МОБИЛЬНАЯ АДАПТАЦИЯ ——— */
  @media (max-width:560px){
    .grid{grid-template-columns:1fr}
    .card{grid-template-columns:1fr}
    .card .btn{width:100%;margin-top:6px}
    .btn-back{width:100%; justify-content:center}

    .brand-title{ font-size:22px }
    .brand-pill{ padding:5px 10px; border-width:2px }

    .chip{padding:6px 8px;font-size:13px; border-width:2px}
    .chip .icon{width:18px;height:18px;padding:1px;border-radius:5px}
    .chip .img-icon{border-radius:3px}
    .chips{gap:6px}

    .tools-bar{gap:8px}
    .search{flex:1 1 100%}
    .search input{min-width:0}
    .view a{width:40px;height:38px}
    .as-list .card{ padding:12px 14px }
  }
  @media (max-width:360px){
    .chip{padding:5px 6px;font-size:12px}
    .chip .icon{width:16px;height:16px}
  }
</style>

<div class="back-wrap">
  <a class="btn-back" href="{% url 'repairs:brand_list' %}?cat={{ selected_cat }}">
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M15 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <span>Назад к брендам</span>
  </a>
</div>

<!-- Хлебные крошки -->
<nav class="breadcrumbs" aria-label="Хлебные крошки">
  <a href="{% url 'repairs:brand_list' %}?cat={{ selected_cat }}">Бренды</a>
  <span class="sep">/</span>
  <span class="brand">{{ brand.name }}</span>
  <span class="sep">/</span>
  <span class="current" aria-current="page">Модели</span>
</nav>

<!-- Категории -->
<div class="chips">
  {% for key,label in categories %}
    {% with src='repairs/icons/cat-'|add:key|add:'.png' %}
      {% if selected_cat == key %}
        <span class="chip chip--{{ key }} active" aria-current="true">
          <span class="icon" aria-hidden="true">
            <img class="img-icon" src="{% static src %}" alt="">
          </span>
          {{ label }}
        </span>
      {% else %}
        <a class="chip chip--{{ key }}" href="?cat={{ key }}{% if view_mode %}&view={{ view_mode }}{% endif %}{% if q %}&q={{ q|urlencode }}{% endif %}">
          <span class="icon" aria-hidden="true">
            <img class="img-icon" src="{% static src %}" alt="">
          </span>
          {{ label }}
        </a>
      {% endif %}
    {% endwith %}
  {% endfor %}
</div>

<!-- Панель: поиск + переключатель вида -->
<form class="tools-bar" method="get" action="">
  <input type="hidden" name="cat" value="{{ selected_cat }}">
  <!-- Поисковая группа -->
  <div class="search" role="search" aria-label="Поиск моделей">
    <span class="lead" aria-hidden="true">
      <!-- лупа -->
      <svg viewBox="0 0 24 24" fill="none">
        <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/>
        <path d="M20 20l-3.5-3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </span>
    <input type="text" name="q" value="{{ q }}" placeholder="Поиск по моделям…"
           aria-label="Поиск по моделям">
    <button type="submit" title="Найти">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="sr-only">Поиск</span>
    </button>
  </div>

  <!-- Переключатель вида -->
  <div class="view" role="tablist" aria-label="Режим отображения">
    <!-- плитка -->
    <a role="tab" title="Плиткой"
       href="?cat={{ selected_cat }}&view=grid{% if q %}&q={{ q|urlencode }}{% endif %}"
       class="{% if view_mode == 'grid' or not view_mode %}active{% endif %}"
       aria-selected="{% if view_mode == 'grid' or not view_mode %}true{% else %}false{% endif %}">
       <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
         <rect x="4" y="4" width="6" height="6" stroke="currentColor" stroke-width="2" rx="1"/>
         <rect x="14" y="4" width="6" height="6" stroke="currentColor" stroke-width="2" rx="1"/>
         <rect x="4" y="14" width="6" height="6" stroke="currentColor" stroke-width="2" rx="1"/>
         <rect x="14" y="14" width="6" height="6" stroke="currentColor" stroke-width="2" rx="1"/>
       </svg>
    </a>
    <!-- список -->
    <a role="tab" title="Списком"
       href="?cat={{ selected_cat }}&view=list{% if q %}&q={{ q|urlencode }}{% endif %}"
       class="{% if view_mode == 'list' %}active{% endif %}"
       aria-selected="{% if view_mode == 'list' %}true{% else %}false{% endif %}">
       <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
         <path d="M8 6h12M8 12h12M8 18h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
         <circle cx="4" cy="6" r="1.5" stroke="currentColor" stroke-width="2"/>
         <circle cx="4" cy="12" r="1.5" stroke="currentColor" stroke-width="2"/>
         <circle cx="4" cy="18" r="1.5" stroke="currentColor" stroke-width="2"/>
       </svg>
    </a>
  </div>
</form>

<!-- Выделенный бренд -->
<div class="brand-head">
  <h1 class="brand-title">
    <span class="brand-pill">{{ brand.name }}</span>
    <span class="brand-path">/ Модели</span>
  </h1>
</div>

{% if models %}
  <div class="{% if view_mode == 'list' %}as-list{% endif %}">
    <div class="grid">
      {% for m in models %}
        <div class="card">
          <div class="info">
            <div class="name">{{ m.name|shrink_parens }}</div>
            <div class="meta">
              <span class="muted">{{ brand.name }}</span>
              <span class="badge">
                {% if m.category == 'phone' %}Телефон{% elif m.category == 'tablet' %}Планшет{% else %}Смарт-часы{% endif %}
              </span>
            </div>
          </div>
          <a class="btn" href="{% url 'repairs:repair_list' brand_slug=brand.slug model_slug=m.slug %}">Выбрать</a>
        </div>
      {% endfor %}
    </div>
  </div>
{% else %}
  <p class="muted">Нет моделей выбранной категории.</p>
{% endif %}

{% endblock %}
