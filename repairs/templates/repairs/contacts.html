{% extends "repairs/base.html" %}
{% load static %}
{% block title %}Контакты — Tehsfera{% endblock %}

{% block content %}
<style>
  .gmap-float{display:none!important} /* скрываем плавающую карту на этой странице */

  .contact-wrap{max-width:1000px;margin:0 auto}
  .contact-grid{display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:16px}
  .card h2{margin:0 0 10px}
  .info li{margin:6px 0;list-style:none}
  .info i{width:18px;margin-right:6px;color:#334155}
  .hours{border-collapse:collapse;width:100%}
  .hours td{padding:6px 0;border-bottom:1px solid #f1f5f9}
  .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#f1f5f9;border:1px solid #e2e8f0}

  .gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  .gallery figure{margin:0;position:relative;overflow:hidden;border-radius:12px;border:1px solid #e5e7eb;background:#f8fafc}
  .gallery img{width:100%;height:170px;object-fit:cover;display:block;transition:transform .25s; cursor:zoom-in}
  .gallery figure:hover img{transform:scale(1.03)}

  .map iframe{width:100%;height:360px;border:0;border-radius:12px}

  @media (max-width: 820px){
    .contact-grid{grid-template-columns:1fr}
    .gallery img{height:200px}
  }

  /* Лайтбокс */
  .lb{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,.85);z-index:999}
  .lb.open{display:flex}
  .lb__img{max-width:90vw;max-height:90vh;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,.35)}
  .lb__close{
    position:fixed;top:14px;right:14px;
    background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.28);
    color:#fff;border-radius:10px;padding:8px 12px;font-size:18px;cursor:pointer
  }
  .lb__close:hover{background:rgba(255,255,255,.18)}
</style>

<div class="contact-wrap">
  <h1 style="margin:0 0 10px">Контакты</h1>
  <p class="muted" style="margin-top:-6px">Свяжитесь с нами или приезжайте в сервисный центр.</p>

  <div class="contact-grid">
    <!-- Инфо -->
    <section class="card">
      <h2>Наши данные</h2>
      <ul class="info" style="padding:0;margin:0">
        <li><i class="fa-solid fa-location-dot"></i>{{ address }}</li>
        <li><i class="fa-solid fa-phone"></i><a href="tel:{{ phone|urlencode }}">{{ phone }}</a></li>
        <li><i class="fa-solid fa-clock"></i><span class="badge">Пн–Сб 10:00–18:00, Вс — выходной</span></li>
      </ul>

      <h3 style="margin:14px 0 8px">График работы</h3>
      <table class="hours">
        {% for day, time in work_hours %}
          <tr>
            <td style="width:40%">{{ day }}</td>
            <td>{{ time }}</td>
          </tr>
        {% endfor %}
      </table>

      <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
        {# GOOGLE: точный поиск «ремонт телефонов гомель гагарина 55» #}
        <a class="btn"
           href="https://www.google.com/maps/search/?api=1&query={{ gmaps_query|default:'ремонт телефонов, Гомель, Гагарина 55'|urlencode }}"
           target="_blank" rel="noopener">
          Открыть в Google Maps
        </a>

        {# YANDEX: режим поиска с нужной фразой #}
        <a class="btn"
           href="https://yandex.by/maps/?mode=search&text={{ ymaps_query|default:'ремонт телефонов Гагарина 55 Гомель'|urlencode }}"
           target="_blank" rel="noopener"
           style="background:#0b1220;border-color:#0b1220">
          Открыть в Яндекс Картах
        </a>
      </div>
    </section>

    <!-- Карта -->
    <section class="card map">
      <h2>Мы на карте</h2>
      <iframe
        loading="lazy"
        allowfullscreen
        referrerpolicy="no-referrer-when-downgrade"
        src="https://maps.google.com/maps?q={{ gmaps_query|default:'ремонт телефонов, Гомель, Гагарина 55'|urlencode }}&hl=ru&z=16&output=embed">
      </iframe>
    </section>
  </div>

  <!-- Фотографии -->
  <section class="card" style="margin-top:18px">
    <h2>Фотографии</h2>
    <div class="gallery">
      <figure><img src="{% static 'img/contacts/01.jpg' %}" alt="Вход в сервис Tehsfera" draggable="false"></figure>
      <figure><img src="{% static 'img/contacts/02.jpg' %}" alt="Ресепшн и зона ожидания" draggable="false"></figure>
      <figure><img src="{% static 'img/contacts/03.jpg' %}" alt="Рабочее место мастера" draggable="false"></figure>
      <figure><img src="{% static 'img/contacts/04.jpg' %}" alt="Диагностическое оборудование" draggable="false"></figure>
      <figure><img src="{% static 'img/contacts/05.jpg' %}" alt="Витрина аксессуаров" draggable="false"></figure>
      <figure><img src="{% static 'img/contacts/06.jpg' %}" alt="Зона выдачи" draggable="false"></figure>
    </div>
  </section>
</div>

<!-- Лайтбокс -->
<div class="lb" id="lightbox" role="dialog" aria-modal="true" aria-label="Просмотр изображения" aria-hidden="true">
  <button class="lb__close" type="button" aria-label="Закрыть">✕</button>
  <img class="lb__img" src="" alt="">
</div>

<script>
(() => {
  const lb = document.getElementById('lightbox');
  const imgEl = lb.querySelector('.lb__img');
  const closeBtn = lb.querySelector('.lb__close');

  function openLB(src, alt) {
    imgEl.src = src; imgEl.alt = alt || "";
    lb.classList.add('open'); lb.setAttribute('aria-hidden','false');
    document.body.style.overflow = 'hidden';
  }
  function closeLB() {
    lb.classList.remove('open'); lb.setAttribute('aria-hidden','true');
    imgEl.src = ""; document.body.style.overflow = '';
  }

  document.addEventListener('click', (e) => {
    const t = e.target;
    if (t.matches('.gallery img')) {
      e.preventDefault();
      const full = t.getAttribute('data-full') || t.currentSrc || t.src;
      openLB(full, t.alt);
    } else if (t === lb || t === closeBtn) {
      closeLB();
    }
  });
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeLB(); });
})();
</script>
{% endblock %}
